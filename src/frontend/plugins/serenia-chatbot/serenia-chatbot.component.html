@if (shouldShowChatbot()) {
  <div
    class="serenia_container"
    [class.keepSereniaIcon]="this.keepSereniaIcon && this.enable"
    [class.show_dialog]="this.showDialog"
    [class.show_notif]="this.newNotification && this.enable">
    <div class="serenia_dialog">
      <div class="serenia_dialog_header">
        <div class="serenia_dialog_header_title">
          <h4>SerenIA</h4>
          <h5>{{ 'lang.serenia_desc' | translate }}</h5>
        </div>
        <div class="serenia_dialog_header_close">
          <i class="fas fa-close fa-2x" (click)="this.toggleDialogPopup()"></i>
        </div>
      </div>
      <div class="serenia_dialog_body">
        @for (message of this.messages; track message) {
          <div>
            @if (!message['user'] && !message['action']) {
              <span>
                <div class="serenia_dialog_message_container" [class.serenia_dialog_message_active]="message['show']">
                  <img ngSrc="assets/serenia-chatbot.png" alt="SerenIA chatbot" height="864" width="863">
                  <span class="serenia_dialog_message" [innerHTML]="message['content'] | translate"></span>
                </div>
              </span>
            }
            @if (message['user'] && !message['action']) {
              <span>
                <div class="user_dialog_message_container">
                  <span class="serenia_dialog_message" [innerHTML]="message['content']"></span>
                  <div>
                    <i class="fa-solid fa-user"></i>
                  </div>
                </div>
              </span>
            }
            @if (this.enable && message['action']) {
              <span>
                @for (action of this.actionsList; track action) {
                  <div style="margin-top: 5px">
                    <div class="serenia_dialog_actions" [class.serenia_dialog_action_active]="action['show']">
                      <button mat-raised-button mat-button color="{{ action['color'] }}" (click)="emitAction(action)">
                        {{ action['label'] | translate }}
                      </button>
                    </div>
                  </div>
                }
              </span>
            }
          </div>
        }
        <div class="serenia_typing" [class.show_typing]="this.sereniaThinking">
          <div class="serenia_dialog_message_container serenia_dialog_message_active">
            <img ngSrc="assets/serenia-chatbot.png" alt="SerenIA chatbot" height="864" width="863">
            <span class="serenia_dialog_message">
              <div class="dot"></div>
              <div class="dot"></div>
              <div class="dot"></div>
            </span>
          </div>
        </div>
      </div>
      @if (this.enable) {
        <div class="serenia_input">
          <input class="serenia_ask" [formControl]="this.userMessageControl" [readonly]="this.sereniaProcessing" type="text" placeholder="{{ 'lang.serenia_input_placeholder' | translate }}" (keyup.enter)="sendMessage()">
          <button mat-flat-button class="serenia_input_send" (click)="sendMessage()" [disabled]="this.sereniaProcessing">
            <i class="fas fa-paper-plane"></i>
          </button>
        </div>
      }
    </div>
    <div class="serenia_notif">
      {{ 'lang.serenia_new_notif' | translate }}
    </div>
    <div [class]="'serenia ' + this.sereniaImageClass" (click)="this.toggleDialogPopup()">
      <div class="serenia_chip">
        <i class="fas fa-circle"></i>
      </div>
    </div>
  </div>
}
