<mat-form-field [class]="class + ' search-select'" [appearance]="appearance" [floatLabel]="appService.getViewMode() || showLabel ? '' : 'never'">
  @if (appService.getViewMode() || showLabel) {
    <mat-label>{{label}}</mat-label>
  }
  <mat-select [id]="id" [formControl]="formControlSelect" [placeholder]="placeholderLabel" #test
    (selectionChange)="launchEvent($event)" [required]="required" [disabled]="disabled" [title]="functions.empty(formControlSelect.value) ? '' : getLabel(formControlSelect.value)" [multiple]="multiple">
    @if (multiple) {
      <mat-select-trigger>
        {{formControlSelect.value.length > 0 ? getFirstDataLabel() : ''}}
        @if (formControlSelect.value?.length > 1) {
          <span class="multipleLabels">
            (+{{formControlSelect.value.length - 1}} {{'lang.others' | translate | lowercase}})
          </span>
        }
      </mat-select-trigger>
    }
    @if (datas.length > 5) {
      <input matInput class="mat-select-search-input mat-select-search-hidden" />
    }

    @if (datas.length > 5) {
      <div class="mat-select-search-inner"
        [ngClass]="{'mat-select-search-inner-multiple': matSelect.multiple}">
        <input id="searchSelectInput" [formControl]="formControlSearch" class="mat-select-search-input"
          #searchSelectInput (keydown)="_handleKeydown($event)" (input)="onInputChange($event.target.value)"
          (blur)="onBlur($event.target.value)" [placeholder]="'lang.filterBy' | translate" />
        @if (formControlSearch.value) {
          <button mat-button mat-icon-button aria-label="Clear" (click)="_reset()"
            class="mat-select-search-clear">
            <mat-icon class="fa fa-times"></mat-icon>
          </button>
        }
        @if (functions.empty(formControlSearch.value) && multiple) {
          <button mat-icon-button style="color: #3A7C00" [disabled]="formControlSelect.value.length === 0" [title]="'lang.displaySelectedValues' | translate" (click)="formControlSearch.setValue('__SELECTED')" class="mat-select-search-clear">
            <mat-icon class="fas fa-check-double"></mat-icon>
          </button>
        }
      </div>
    }

    @if (value && _options?.length === 0 && datas.length > 5) {
      <div class="mat-select-search-no-entries-found">
        {{'lang.noResult' | translate}}
      </div>
    }
    @if (showResetOption) {
      <mat-option (onSelectionChange)="selectChange($event)" [value]="emptyData()">({{'lang.emptyValue' | translate}})</mat-option>
    }
    @for (value of filteredDatas | async; track value) {
      <mat-option (onSelectionChange)="selectChange($event)" [value]="returnValue === 'id' ? value.id : value"
        [title]="value.title !== undefined ? value.title : value.label" [disabled]="value.disabled"
        [class.opt-group]="value.isTitle" [class.fixPos]="value.isTitle && datas.length > 5" [style.color]="value.color">
        <span [innerHTML]="value.label"></span>
      </mat-option>
    }
  </mat-select>
  @if (formControlSelect.status!=='VALID' && formControlSelect.touched && !hideErrorDesc) {
    <mat-error>
    {{getErrorMsg(formControlSelect.errors)}}</mat-error>
  }
  @if (suffixIcon !== null) {
    <mat-icon style="height: auto;" matSuffix [style.color]="suffixIcon.color"
      class="fas fa-circle selectSuffixIcon" [title]="suffixIcon.title !== undefined ? suffixIcon.title : ''">
    </mat-icon>
  }
</mat-form-field>