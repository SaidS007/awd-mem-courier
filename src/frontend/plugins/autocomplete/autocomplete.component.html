<form>
  @if (control !== undefined) {
    <input type="hidden" [formControl]="control">
  }
  <mat-form-field class="maarch-autocomplete" [class.no-margin]="styles.indexOf('no-margin') > -1" [class.smallInput]="size === 'small'" [appearance]="appearance" floatLabel="never" (click)="$event.stopPropagation();">
    @if (singleMode) {
      <mat-label>{{labelPlaceholder}}</mat-label>
    }
    @if (size !== 'small' && (myControl.enabled && !singleMode)) {
      <mat-icon style="color: #3A7C00" class="fa fa-search"
      matPrefix></mat-icon>
    }
    <input type="text" id="autoCompleteInput" #autoCompleteInput [placeholder]="singleMode ? '' : labelPlaceholder"
      aria-label="Number" matInput [formControl]="myControl" [matAutocomplete]="auto"
      (click)="$event.stopPropagation()" (focus)="resetAutocomplete()" [required]="required"
      (keyup.enter)="addItem()">
    @if (myControl.disabled) {
      <button type="button" matSuffix mat-icon-button class="warn" (click)="unsetValue()">
        <mat-icon class="fa fa-times" style="color:#8e3e52" [title]="'lang.delete' | translate"></mat-icon>
      </button>
    }
    <mat-autocomplete #auto="matAutocomplete" (optionSelected)="selectOpt($event)" [displayWith]="displayFnWrapper()" >
      @if (datas.length > 0 && !loading) {
        @for (option of filteredOptions | async | sortBy: targetSearchKey; track option) {
          <mat-option [value]="option" [disabled]="disableItems.indexOf(option['serialId']) > -1">
            @if (type[option['type']]) {
              <mat-icon class="autcompleteIcon fas {{type[option['type']]}}"
                style="color: #3A7C00">
              </mat-icon>
              }&nbsp;<span
              class="primary">{{option[targetSearchKey]}}</span>&nbsp;<small>{{option[subInfoKey]}}</small>
            </mat-option>
          }
        }
        @if (datas.length === 0 && !loading) {
          <mat-option class="autoCompleteInfoResult smallInputInfo" disabled
            [innerHTML]="listInfo">
          </mat-option>
        }
        @if (loading) {
          <mat-option disabled>
            <mat-spinner diameter="20"></mat-spinner>
          </mat-option>
        }
        @if (fromExternalWorkflow && connectorLength > 0) {
          <div class="autoCompleteInfoResult create-contact" style="font-size: 11px;">
            <button style="cursor: pointer;" (click)="$event.stopPropagation(); createExternalUser()" [title]="'lang.addOtp' |Â translate">
              <mat-icon matSuffix class="fas fa-user-plus" style="padding-top: 5px"></mat-icon>
              {{'lang.addOtp' | translate}}
            </button>
          </div>
        }
      </mat-autocomplete>
    </mat-form-field>
    @if (control !== undefined) {
      <mat-chip-list class="mat-chip-list-stacked" >
        @for (item of control.value; track item; let i = $index) {
          <mat-chip class="activeListAutocomplete"
            [removable]="true" (removed)="removeItem(i)">
            <span style="display: flex;flex: 1;" [innerHTML]="this.valuesToDisplay[item]"></span>
            <mat-icon matChipRemove class="fa fa-times"></mat-icon>
          </mat-chip>
        }
      </mat-chip-list>
      @if (control.value.length === 0) {
        <div class="noResult">
          {{'lang.noSelectedValue' | translate}}
        </div>
      }
    }
  </form>