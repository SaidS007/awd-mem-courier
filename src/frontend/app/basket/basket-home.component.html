@if (!loading) {
  <mat-expansion-panel #basketPanel class="basketList" expanded>
    <mat-expansion-panel-header>
      <mat-panel-title>
        <div style="flex: 1;display: flex;align-items: center;">
          <i class="fa fa-inbox panelIconMenu"></i>&nbsp;{{'lang.myBaskets' | translate}}
        </div>
        <div style="display: flex;align-items: center;" title="{{'lang.listConfiguration' | translate}}" (click)="$event.stopPropagation();editGroupOrder()" (mouseover)="hoverEditGroupOrder=true" (mouseleave)="hoverEditGroupOrder=false">
          <mat-icon [ngStyle]="{'color': editOrderGroups ? 'orange' : '#3A7C00', 'opacity': editOrderGroups || hoverEditGroupOrder ? '1' : '0.4'}" mat-list-icon class="fa fa-cog" style="height:auto;"></mat-icon>
        </div>
      </mat-panel-title>
    </mat-expansion-panel-header>
    @if (!loading) {
      <mat-form-field [style.display]="(homeData.assignedBaskets.length > 0 || homeData.regroupedBaskets.length > 0) && !editOrderGroups ? 'inline-block' : 'none'" floatLabel="never" appearance="outline" class="basketsFilter"
        style="padding-left:20px;padding-right:20px;font-size: 11px;">
        <input matInput placeholder="{{'lang.filterBy' | translate}}" #listFilter>
      </mat-form-field>
      @if (editOrderGroups) {
        <div style="color: rgba(0,0,0,0.25);text-align:center;">
          {{'lang.noticeGroupeOrder' | translate}}
        </div>
      }
      @if (editOrderGroups) {
        <mat-list>
          <div cdkDropList #dataAvailableList="cdkDropList" [cdkDropListData]="homeData.regroupedBaskets" (cdkDropListDropped)="onGroupDop($event)">
            @for (regroupedBasket of homeData.regroupedBaskets; track regroupedBasket; let i = $index) {
              <mat-list-item class="cdk-list"  disableRipple="true"
                [title]="'lang.move' | translate" [cdkDragData]="regroupedBasket" cdkDrag style="cursor: move;">
                <mat-icon mat-list-icon class="fa fa-arrows-alt" style="font-size:19px; color: #3A7C00"></mat-icon>
                <span class="basketGroupTitle">{{regroupedBasket.groupDesc}}</span>
              </mat-list-item>
            }
          </div>
        </mat-list>
      }
      @for (regroupedBasket of homeData.regroupedBaskets; track regroupedBasket) {
        @if (regroupedBasket.baskets[0] && !editOrderGroups) {
          <span class="basketGroupTitle">{{regroupedBasket.groupDesc}}</span>
        }
        @if (regroupedBasket.baskets[0] && !editOrderGroups) {
          <mat-divider style="width: 80%;"></mat-divider>
        }
        @if (!editOrderGroups) {
          <mat-nav-list style="padding-bottom: 10px;">
            @for (basket of regroupedBasket.baskets | filterList:listFilter.value:'basket_name'; track basket) {
              @if (basket.redirected) {
                <button mat-list-item disableRipple="true" style="cursor:not-allowed;">
                  @if (basket.redirected && !appService.getViewMode()) {
                    <mat-icon [ngStyle]="{'color': basket.color}"
                      mat-list-icon class="fa fa-share">
                    </mat-icon>
                  }
                  @if (basket.resourceNumber === 0) {
                    <span class="nbResZero" [style.color]="basket.color">{{basket.resourceNumber}}</span>
                  }
                  @if (basket.resourceNumber !== 0) {
                    <span class="nbRes" [ngStyle]="{'color': basket.color !== '#666666' ? basket.color : ''}" [class.defaultColor]="basket.color === '#666666'">{{basket.resourceNumber}}</span>
                  }
                  <p mat-line title="{{basket.basket_name}}" [ngStyle]="{'color': basket.color}">
                    {{basket.basket_name}}<br /><small class="primary">({{'lang.redirectedTo' | translate}}
                  {{basket.redirectedUser}})</small>
                </p>
              </button>
            }
            @if (!basket.redirected) {
              <a mat-list-item
                [ngClass]="{'selectedBasket': headerService.currentBasketInfo.basketId === basket.id && headerService.currentBasketInfo.ownerId === basket.owner_user_id && headerService.currentBasketInfo.groupId === regroupedBasket.groupSerialId}"
                (click)="refreshDatas(basket);closePanelLeft();"
                routerLink="/basketList/users/{{basket.owner_user_id}}/groups/{{regroupedBasket.groupSerialId}}/baskets/{{basket.id}}"
                style="cursor:pointer;"
                [ngStyle]="{'opacity': basket.resourceNumber === 0 ? '0.5' : '1', 'height': appService.getViewMode() ? '50px' : '38px'}"
                [attr.aria-current]="(headerService.currentBasketInfo.basketId === basket.id && headerService.currentBasketInfo.ownerId === basket.owner_user_id && headerService.currentBasketInfo.groupId === regroupedBasket.groupSerialId) ? 'true' : null">
                @if (basket.resourceNumber === 0) {
                  <span class="nbResZero" [style.color]="basket.color">{{basket.resourceNumber}}</span>
                }
                @if (basket.resourceNumber !== 0) {
                  <span class="nbRes" [ngStyle]="{'color': basket.color !== '#666666' ? basket.color : ''}" [class.defaultColor]="basket.color === '#666666'">{{basket.resourceNumber}}</span>
                }
                <p mat-line title="{{basket.basket_name}}" [ngStyle]="{'color': basket.color}">
                  {{basket.basket_name}}
                </p>
              </a>
            }
          }
        </mat-nav-list>
      }
    }
    @if (homeData.assignedBaskets.length>0 && !editOrderGroups) {
      <span class="primary" style="font-weight:bold;"
      title="{{'lang.assignedBaskets' | translate}}">{{'lang.assignedBasketsShort' | translate}}</span>
      <mat-divider></mat-divider>
      <mat-nav-list>
        @for (basket of homeData.assignedBaskets | filterList:listFilter.value:'basket_name'; track basket) {
          <a mat-list-item
            [ngClass]="{'selectedBasket': headerService.currentBasketInfo.basketId  === basket.id && headerService.currentBasketInfo.ownerId === basket.owner_user_id && headerService.currentBasketInfo.groupId === basket.group_id}"
            [attr.aria-current]="headerService.currentBasketInfo.basketId === basket.id && headerService.currentBasketInfo.ownerId === basket.owner_user_id && headerService.currentBasketInfo.groupId === basket.group_id ? 'true' : null"
            routerLink="/basketList/users/{{basket.owner_user_id}}/groups/{{basket.group_id}}/baskets/{{basket.id}}">
            @if (!appService.getViewMode()) {
              <mat-icon style="color:#666" mat-list-icon
              class="fa fa-paper-plane"></mat-icon>
            }
            @if (basket.resourceNumber === 0) {
              <span class="nbResZero" [style.color]="basket.color">{{basket.resourceNumber}}</span>
            }
            @if (basket.resourceNumber !== 0) {
              <span class="nbRes" [ngStyle]="{'color': basket.color !== '#666666' ? basket.color : ''}" [class.defaultColor]="basket.color === '#666666'">{{basket.resourceNumber}}</span>
            }
            <p mat-line title="{{basket.basket_name}}" style="color:#666">
              {{basket.basket_name}}<br /><small class="primary">({{basket.userToDisplay}} -
            {{basket.group_desc}})</small>
          </p>
        </a>
      }
    </mat-nav-list>
  }
  @if (homeData.assignedBaskets.length === 0 && homeData.regroupedBaskets.length === 0) {
    <div class="noBasket">
      {{'lang.noAvailableBasket' | translate}}
    </div>
  }
}
</mat-expansion-panel>
}
