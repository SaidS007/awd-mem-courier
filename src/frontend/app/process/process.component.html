<mat-sidenav-container class="maarch-container">
  <ng-template #adminMenuTemplate>
    @if (!detailMode && canShowDivBrowsing && !loading) {
      <div class="divBrowsing" style="margin-bottom: 10px;">
        <button mat-button style="color: #3A7C00 !important; background: none !important;" (click)="$event.stopPropagation(); goToResource('previous')"
          [title]="'lang.previousRes' | translate" [disabled]="!canGoToPrevious"> <!-- EDISSYUM - ALO01 Amélioration RGAA | Remplacer color="primary" par style="color: #797676 !important;background: none !important" -->
          <mat-icon class="fa fa-angle-left" style="height:auto"></mat-icon>
          {{'lang.previous' | translate}}
        </button>
        <button mat-button style="color: #3A7C00; background: none !important" (click)="$event.stopPropagation(); goToResource('next')"
          [title]="'lang.nextRes' | translate" [disabled]="!canGoToNext"> <!-- EDISSYUM - ALO01 Amélioration RGAA | Remplacer color="primary" par style="color: #3A7C00; background: none !important"-->
          {{'lang.next' | translate}}
          <mat-icon  class="fa fa-angle-right" style="height:auto"></mat-icon>
        </button>
      </div>
      <mat-divider></mat-divider>
    }
    @if ((resourceFreezed || resourceBinded !== null) && !loading) {
      <div class="alert-message alert-message-danger"
        style="min-width: 100%; margin: 10px 0;">
        @if (resourceFreezed) {
          <div style="display: flex;align-items: center;">
            <i class="fas fa-snowflake" style="width: 25px;text-align: center;"></i>&nbsp;<span [innerHTML]="'lang.retentionRuleFrozenAlt' | translate"></span>
          </div>
        }
        @if (resourceBinded !== null) {
          <div style="display: flex;align-items: center;">
            <i class="fas fa-exclamation" style="width: 25px;text-align: center;"></i>&nbsp;
            <span
              [innerHTML]="resourceBinded ? ('lang.bindingMailAlt' | translate) : ('lang.noBindingMailAlt' | translate)">
            </span>
            &nbsp;
            <i class="fa fa-info-circle" style="cursor: help;opacity: 0.5;"
            [title]="resourceBinded ? ('lang.bindingMailDesc' | translate) : ('lang.noBindingMailDesc' | translate)"></i>
          </div>
        }
      </div>
    }
    <div class="listModels">
      <div class="processTool">
        @for (module of processTool; track module) {
          <div class="processTool-module jiggle"
            [class.processTool-module-active]="module.id === currentTool" matRipple
            (click)="isToolEnabled(module.id) ? changeTab(module.id) : false"
            [class.tool-disabled]="!isToolEnabled(module.id)">
            @if (module.count > 0) {
              <i class="fas fa-circle haveContent"></i>
            }
            <i [class]="module.icon"></i>
            <span>{{module.label}}</span>
          </div>
        }
      </div>
    </div>
    <div class="indexing-form-container">
      @if (!isModalOpen() && currentTool !== 'dashboard') {
        <div style="display: flex;justify-content: flex-end;">
          @if (privilegeService.hasCurrentUserPrivilege('view_technical_infos')) {
            <button mat-icon-button
              (click)="openTechnicalInfo()" style="color: #3A7C00"
              [title]="'lang.showTechnicalInfo' | translate">
              <mat-icon class="far fa-file-code"></mat-icon>
            </button>
          }
          <button mat-icon-button (click)="createModal()" style="color: #3A7C00"
            [title]="'lang.openInExternalModal' | translate">
            <mat-icon class="fas fa-external-link-alt"></mat-icon>
          </button>
        </div>
      }
      @if (currentTool === 'dashboard') {
        <div
          style="display: flex;align-items: center;justify-content: flex-end;margin-top: 10px;margin-bottom: -20px;">
          <button mat-button style="color: #3A7C00;"
            [title]="'lang.generateAndDownloadPrintedFolder' | translate"
            (click)="openPrintedFolderPrompt()"> <!-- EDISSYUM - ALO01 Amélioration RGAA | Remplacer color="primary" par style="color: #3A7C00;"-->
            <mat-icon class="fa fa-print" style="height:auto"></mat-icon>
            {{'lang.printedFolder' | translate}}
          </button>
        </div>
        <div class="banner">
          <div class="title" (click)="currentTool = 'history'">
            {{'lang.history' | translate}}
            <div class="title-divider"></div>
          </div>
          <div class="content">
            @if (!loading) {
              <app-history-workflow-resume [resId]="currentResourceInformations.resId"
                (goTo)="currentTool = 'history'">
              </app-history-workflow-resume>
            }
          </div>
        </div>
        <div class="banner">
          <div class="title" (click)="currentTool = 'notes'">
            {{'lang.notesAlt' | translate}}
            <div class="title-divider"></div>
          </div>
          <div class="content">
            @if (!loading) {
              <app-note-resume [resId]="currentResourceInformations.resId"
                (goTo)="currentTool = 'notes'">
              </app-note-resume>
            }
          </div>
        </div>
        <div class="banner">
          <div class="title" (click)="currentTool = 'attachments'">
            {{'lang.attachments' | translate}}
            <div class="title-divider"></div>
          </div>
          <div class="content">
            @if (!loading) {
              <app-attachments-resume [resId]="currentResourceInformations.resId"
                (goTo)="currentTool = 'attachments'">
              </app-attachments-resume>
            }
          </div>
        </div>
        <div class="banner">
          <div class="title" (click)="currentTool = 'emails'">
            {{'lang.mailsSentAlt' | translate}}
            <div class="title-divider"></div>
          </div>
          <div class="content">
            @if (!loading) {
              <app-mail-resume [resId]="currentResourceInformations.resId"
                (goTo)="currentTool = 'emails'">
              </app-mail-resume>
            }
          </div>
        </div>
      }
      @if (!isModalOpen() && !loading) {
        @if (currentTool === 'history' && !loading) {
          <app-history-list #appHistoryList
            [resId]="currentResourceInformations.resId">
          </app-history-list>
        }
        @if (currentTool === 'notes' && !loading) {
          <app-notes-list #appNotesList [editMode]="true"
            [resId]="currentResourceInformations.resId" (reloadBadgeNotes)="refreshBadge($event,'notes')" [basketId]="currentBasketId"> <!-- EDISSYUM - NCH01 Fix pour afficher les templates de notes en fonction de l'entitié du user et non de la destination du courrier | Ajout de  [basketId]="currentBasketId" -->
          </app-notes-list>
        }
        @if (currentTool === 'linkedResources' && !loading) {
          <app-linked-resource-list #appLinkedResourceList
            [resId]="currentResourceInformations.resId"
            (reloadBadgeLinkedResources)="refreshBadge($event,'linkedResources')">
          </app-linked-resource-list>
        }
        @if (currentTool === 'diffusionList' && !loading) {
          <app-diffusions-list #appDiffusionsList
            [adminMode]="true" [target]="detailMode ? 'details': 'process'"
            [resId]="currentResourceInformations.resId" [expanded]="true">
          </app-diffusions-list>
        }
        @if (currentTool === 'emails' && !loading) {
          <app-sent-resource-list #appSentResource
            [resId]="currentResourceInformations.resId" [currentUserId]="currentUserId"
            [currentGroupId]="currentGroupId" [currentBasketId]="currentBasketId"
            (reloadBadgeSentResource)="refreshBadge($event,'emails')">
          </app-sent-resource-list>
        }
        @if (currentTool === 'visaCircuit' && !loading) {
          <app-visa-workflow #appVisaWorkflow
            [resId]="currentResourceInformations.resId"
            [adminMode]="detailMode ? privilegeService.hasCurrentUserPrivilege('config_visa_workflow_in_detail') : privilegeService.hasCurrentUserPrivilege('config_visa_workflow')">
          </app-visa-workflow>
        }
        @if (currentTool === 'opinionCircuit' && !loading) {
          <app-avis-workflow #appAvisWorkflow
            [resId]="currentResourceInformations.resId"
            [adminMode]="detailMode ? privilegeService.hasCurrentUserPrivilege('config_avis_workflow_in_detail') : privilegeService.hasCurrentUserPrivilege('config_avis_workflow')">
          </app-avis-workflow>
        }
        @if (currentTool === 'attachments' && !loading) {
          <app-attachments-list #appAttachmentsList
            [resId]="currentResourceInformations.resId" [autoOpenCreation]="isMailing" [target]="'process'"
            (reloadBadgeAttachments)="refreshBadge($event,'attachments')">
          </app-attachments-list>
        }
        @if (currentTool === 'info' && !loading) {
          <app-select-indexing-model
              #appSelectIndexingModel
              [defaultIndexingModelId]="currentResourceInformations.modelId"
              [adminMode]="canChangeModel"
              [indexingForm]="indexingForm"
              (afterSelectedListModel)="setValues($event); indexingForm.loadForm($event.indexingModel.id, false); changedIndexingFormModel = currentResourceInformations.modelId !== $event.indexingModel.id">
          </app-select-indexing-model>
        }
        @if (currentTool === 'info' && !loading && !functions.empty(currentResourceInformations.registeredMail_deposit_id)) {
          <div
            class="alert-message alert-message-info" style="min-width: 100%;"
          [innerHTML]="'lang.dispositListGeneratedMsg' | translate"></div>
        }
        @if (currentTool === 'info' && !loading) {
          <app-indexing-form #indexingForm [groupId]="currentGroupId"
            [resId]="currentResourceInformations.resId" [indexingFormId]="currentResourceInformations.modelId"
            [mode]="'process'" [canEdit]="canEditData" [hideDiffusionList]="true" [canChangeModel]="canChangeModel"
            (loadingFormEndEvent)="triggerProcessAction()" (reloadBadge)="refreshBadge(1,'linkedResources')"
            (retrieveDocumentEvent)="appDocumentViewer.saveDocService()" (afterSaveEvent)="refreshData()">
          </app-indexing-form>
          } <!-- EDISSYUM - NCH01 Amélioration de l'écran de qualification pour récupérer les données par défaut | ajout canChangeModel -->
          <div style="position: sticky;bottom: 0px;text-align:right;">
            @if (isToolModified()) {
              <button mat-fab [title]="'lang.saveModifications' | translate"
                (click)="saveTool()" class="accent">
                <mat-icon style="height:auto;font-size:20px;color:white" class="fas fa-check"></mat-icon>
              </button>
            }
          </div>
        }
        @if (isModalOpen() && !loading) {
          <div class="openedModal">
            <i class="fas fa-external-link-alt"></i>
            {{'lang.openedInExternalModal' | translate}}
          </div>
        }
      </div>
      @if (!detailMode) {
        <div class="actions-indexing-form">
          @if (actionsListLoaded && hasActions() && selectedAction !== undefined) {
            <button mat-button class="button-form-primary" [disabled]="selectedAction.id === 0"
              [matMenuTriggerFor]="menu" style="width:350px;margin-right:20px;" [title]="selectedAction.label">
              <span class="menu-label" [innerHTML]="selectedAction.label">
              </span>
              <i class="fa fa-chevron-down menu-icon"></i></button>
              <mat-menu #menu="matMenu" [class]="'menuForm menuAction'">
                <div class="menuTitle">
                  <span>
                    {{'lang.actions' | translate}}
                  </span>
                  <mat-form-field floatLabel="never" appearance="outline" class="smallInput"
                    (click)="$event.stopPropagation();">
                    <input matInput id="searchTerm" placeholder="{{'lang.filterBy' | translate}}" #listFilter
                      autocomplete="off" (click)="$event.stopPropagation();"
                      (keydown)="$event.stopPropagation()">
                  </mat-form-field>
                </div>
                @for (action of actionsList | filterList:listFilter.value:'label'; track action) {
                  @if (showActionInCurrentCategory(action)) {
                    <button mat-menu-item (click)="selectAction(action)"
                      [title]="action.label" [class.listModels-menu-selected]="action.id === selectedAction.id">
                      <span style="flex:1;">{{action.label}}</span>
                    </button>
                  }
                }
              </mat-menu>
              @if (!appService.getViewMode()) {
                <button mat-button
                  [disabled]="disableSubmit() || actionService.loading || selectedAction.id === 0 || (appDocumentViewer !== undefined && !appDocumentViewer.isEditorLoaded())"
                  class="button-form-primary-filled"
                  style="width: 150px;align-items: center;justify-content: center;text-align: center;display: flex;"
                (click)="onSubmit()">{{'lang.validate' | translate}}</button>
                } <!-- EDISSYUM - NCH01 Module OCForMEM NextGen | Ajout disableSubmit() -->
                @if (appService.getViewMode()) {
                  <button mat-icon-button class="button-form-primary"
                    (click)="onSubmit()">
                    <mat-icon class="fa fa-check"></mat-icon>
                  </button>
                }
              }
              @if (actionsListLoaded && !hasActions()) {
                <div class="emptyAction"
                [innerHTML]="'lang.noAvailableActionProcess' | translate"></div>
              }
            </div>
          }
        </ng-template>
        <mat-sidenav-content class="process-content">
          <div class="bg-head">
            <div class="bg-head-title" style="margin-bottom: -10px;" [class.customContainerRight]="appService.getViewMode()">
              <div class="bg-head-title-label">
                <app-header-left></app-header-left>
              </div>
              <div class="bg-head-title-tool">
                <app-header-right></app-header-right>
              </div>
            </div>
            <div class="bg-head-content" [class.fullContainer]="appService.getViewMode()" style="padding-bottom: 20px;">
              <div [class.banner-opened]="blocOpened" [class.banner-closed]="!blocOpened">
                <div class="title" style="cursor:pointer; padding-right: 10px;"
                  (click)="blocOpened = !blocOpened; $event.stopPropagation();">
                  <i class="far" [class.fa-plus-square]="!blocOpened" [class.fa-minus-square]="blocOpened" [title]="(!blocOpened ? 'lang.showInformationsBlock' : 'lang.hideInformationsBlock') | translate"
                  style="cursor:pointer;margin-left: 10px; padding-left: 5px;"></i>&nbsp;
                  <span style="white-space: nowrap; margin-left: -10px;"
                    [title]="this.currentResourceInformations.subject + ' (' + this.currentResourceInformations.statusLabel + ')'">
                    {{this.currentResourceInformations.subject}} <small
                  class="subSubject">{{this.currentResourceInformations.statusLabel}}</small>
                </span>
                @if (blocOpened) {
                  <div class="title-divider"></div>
                }
              </div>
              <div class="content">
                <div class="resourceInfo">
                  @if (!loading) {
                    <div class="content">
                      <button mat-icon-button
                        [title]="this.resourceFollowed ? ('lang.untrackThisMail' | translate) : ('lang.trackThisMail' | translate)"
                        class="categoryLabel" (click)="toggleFollow()">
                        <mat-icon class="followIcon {{this.resourceFollowed ? 'fas':'far'}} fa-star"
                        style="font-size: 20px;"></mat-icon>
                      </button>
                      @if (privilegeService.hasCurrentUserPrivilege('freeze_retention_rule')) {
                        <button
                          mat-icon-button
                          [title]="resourceFreezed ? ('lang.unfreezeRetentionRule' | translate) :  ('lang.freezeRetentionRule' | translate)"
                          class="categoryLabel" (click)="toggleFreezing()">
                          <mat-icon
                            class="{{this.resourceFreezed ? 'freezeUnfreezIcon':'nonFreeze'}} fas fa-snowflake"
                          style="font-size: 20px;"></mat-icon>
                        </button>
                      }
                      @if (privilegeService.hasCurrentUserPrivilege('set_binding_document')) {
                        <button mat-icon-button
                          [matMenuTriggerFor]="bindingRentalRule"
                          [title]="'lang.setBindingDocument' | translate" class="categoryLabel">
                          <mat-icon class="bindIcon fas fa-exclamation" style="font-size: 20px;"></mat-icon>
                        </button>
                      }
                      <mat-menu #bindingRentalRule="matMenu">
                        <buton mat-menu-item [class.isSelectedMenu]="this.resourceBinded === true"
                          (click)="toggleBinding(true)" [title]="'lang.bindingMail' | translate | stripTags"
                        [innerHTML]="'lang.bindingMail' | translate"></buton>
                        <mat-divider></mat-divider>
                        <buton mat-menu-item [class.isSelectedMenu]="this.resourceBinded === false"
                          (click)="toggleBinding(false)"
                          [title]="'lang.noBindingMail' | translate | stripTags"
                        [innerHTML]="'lang.noBindingMail' | translate"></buton>
                        <mat-divider></mat-divider>
                        <buton mat-menu-item [class.isSelectedMenu]="this.resourceBinded === null"
                          (click)="toggleBinding(null)" [title]="'lang.doNotDefine' | translate">
                        {{ 'lang.doNotDefine' | translate}}</buton>
                        <mat-divider></mat-divider>
                      </mat-menu>
                      @if (this.currentResourceInformations.priority !== undefined) {
                        <div class="content-item">
                          <b><i class="fas fa-flag" [style.color]="this.currentResourceInformations.priorityColor"
                          style="font-size: 25px;padding-right: 20px;"></i>
                        {{this.currentResourceInformations.priorityLabel}}</b>
                      </div>
                    }
                    <div class="content-item">
                      <div>{{'lang.chronoNumberShort' | translate}} :</div>
                      <div class="content-item-value" [title]="'N° '+this.currentResourceInformations.resId">
                      {{this.currentResourceInformations.chrono}}</div>
                    </div>
                    <div class="content-item" (click)="openContact()" style="cursor:pointer">
                      <div>
                        {{this.currentResourceInformations.categoryId !== 'outgoing' ? ('lang.senders' | translate) : ('lang.recipient' | translate)}}
                      :</div>
                      <div class="content-item-value">{{senderLightInfo.displayName}} @if (this.senderLightInfo.filling) {
                        <i
                          class="fas fa-circle"
                        style="font-size: 8px" [style.color]="this.senderLightInfo.filling"></i>
                      }</div>
                    </div>
                    @if (!functions.empty(currentResourceInformations.registeredMail_returnDate)) {
                      <div class="content-item"
                        >
                        <div>{{'lang.returnDate' | translate}} :</div>
                        <div class="content-item-value"
                          [title]="this.currentResourceInformations.registeredMail_returnDate | fullDate">
                          {{this.currentResourceInformations.registeredMail_returnDate | date: 'dd/MM/y'}}
                        </div>
                      </div>
                    }
                    @if (!functions.empty(currentResourceInformations.registeredMail_returnReason)) {
                      <div class="content-item"
                        >
                        <div>{{'lang.returnReason' | translate}} :</div>
                        <div class="content-item-value"
                          [title]="this.currentResourceInformations.registeredMail_returnReason">
                        {{this.currentResourceInformations.registeredMail_returnReason}}</div>
                      </div>
                    }
                    @if (this.currentResourceInformations.processLimitDate !== undefined) {
                      <div class="content-item"
                        >
                        @if (this.currentResourceInformations.closingDate !== null) {
                          <div style="font-weight: bold;"
                            [title]="this.currentResourceInformations.closingDate | fullDate">
                            {{'lang.closed' | translate}}
                            {{this.currentResourceInformations.closingDate | timeAgo : 'full'}}&nbsp;&nbsp;<i
                          class="fa fa-lock"></i></div>
                        } @else {
                          <div>{{'lang.processLimitDate' | translate}} :</div>
                          <div class="content-item-value"
                            [title]="this.currentResourceInformations.processLimitDate | fullDate"
                            [innerHTML]="this.currentResourceInformations.processLimitDate | timeLimit : 'badge'">
                          </div>
                        }
                      </div>
                    }
                    <div
                      style="position: absolute;right: 0px;top: 0px;height: 100%;display: flex;flex-direction: column;justify-content: center;">
                      @for (inteKey of integrationsInfo | keyvalue; track inteKey) {
                        <button mat-icon-button
                          matTooltip="{{'lang.' + inteKey.key | translate}}"
                          (click)="toggleIntegration(inteKey.key)">
                          <mat-icon [class]="inteKey.value.icon"
                            [class.checked]="currentResourceInformations.integrations[inteKey.key]"
                            [class.unchecked]="!currentResourceInformations.integrations[inteKey.key]">
                          </mat-icon>
                        </button>
                      }
                    </div>
                  </div>
                } @else {
                  <div class="loadingBanner">
                    <mat-spinner diameter="35"></mat-spinner>
                  </div>
                }
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="document-container" [class.fullContainer]="appService.getViewMode()">
        <div class="content">
          @if (!loading) {
            <app-document-viewer #appDocumentViewer style="height:100%;width:100%;"
              [editMode]="canEditData"
              [resId]="currentResourceInformations.resId"
              [chrono]="currentResourceInformations.chrono"
              [title]="currentResourceInformations.chrono + ' - ' + currentResourceInformations.subject"
              [realUserId]="this.currentUserId"><!-- EDISSYUM - NCH01 Fix pour permettre la modification d'un courrier si le typist est égal à l'utilisateur connecté | Ajout realUserId -->
            </app-document-viewer>
          }
        </div>
      </div>
      @for (modal of modalModule; track modal; let i = $index) {
        <div class="modal-module {{modal.id}} largeModal" cdkDrag
          cdkDragBoundary=".process-content">
          <div class="modal-module-title" cdkDragHandle>
            <span>
              {{modal.label}}
            </span>
            <button mat-icon-button (click)="removeModal(i)">
              <mat-icon class="fas fa-times"></mat-icon>
            </button>
          </div>
          <div class="modal-module-content">
            @if (modal.id === 'history' && !loading) {
              <app-history-list #appHistoryList
                [resId]="currentResourceInformations.resId">
              </app-history-list>
            }
            @if (modal.id === 'notes' && !loading) {
              <app-notes-list #appNotesList [editMode]="true"
                [resId]="currentResourceInformations.resId" (reloadBadgeNotes)="refreshBadge($event,'notes')">
              </app-notes-list>
            }
            @if (modal.id === 'linkedResources' && !loading) {
              <app-linked-resource-list #appLinkedResourceList
                [resId]="currentResourceInformations.resId"
              (reloadBadgeLinkedResources)="refreshBadge($event,'linkedResources')"></app-linked-resource-list>
            }
            @if (modal.id === 'diffusionList' && !loading) {
              <app-diffusions-list #appDiffusionsList
                [adminMode]="true" [target]="detailMode ? 'details': 'process'"
                [resId]="currentResourceInformations.resId" [expanded]="true">
              </app-diffusions-list>
            }
            @if (modal.id === 'emails' && !loading) {
              <app-sent-resource-list #appSentResource
                [resId]="currentResourceInformations.resId"
                (reloadBadgeSentResource)="refreshBadge($event,'emails')">
              </app-sent-resource-list>
            }
            @if (modal.id === 'visaCircuit' && !loading) {
              <app-visa-workflow
                [adminMode]="detailMode ? privilegeService.hasCurrentUserPrivilege('config_visa_workflow_in_detail') : privilegeService.hasCurrentUserPrivilege('config_visa_workflow')"
                #appVisaWorkflow [resId]="currentResourceInformations.resId">
              </app-visa-workflow>
            }
            @if (modal.id === 'opinionCircuit' && !loading) {
              <app-avis-workflow #appAvisWorkflow
                [resId]="currentResourceInformations.resId"
                [adminMode]="detailMode ? privilegeService.hasCurrentUserPrivilege('config_avis_workflow_in_detail') : privilegeService.hasCurrentUserPrivilege('config_avis_workflow')">
              </app-avis-workflow>
            }
            @if (modal.id === 'attachments'  && !loading) {
              <app-attachments-list #appAttachmentsList
                [resId]="currentResourceInformations.resId" [autoOpenCreation]="isMailing"
                (reloadBadgeAttachments)="refreshBadge($event,'attachments')">
              </app-attachments-list>
            }
            @if (modal.id === 'info' && !loading) {
              <app-select-indexing-model #appSelectIndexingModel
                [adminMode]="canChangeModel" [indexingForm]="indexingForm"
                [defaultIndexingModelId]="currentResourceInformations.modelId"
              (afterSelectedListModel)="setValues($event); indexingForm.loadForm($event.indexingModel.id, false)"></app-select-indexing-model>
            }
            @if (modal.id === 'info' && !loading && !functions.empty(currentResourceInformations.registeredMail_deposit_id)) {
              <div
                class="alert-message alert-message-info" style="min-width: 100%;"
              [innerHTML]="'lang.dispositListGeneratedMsg' | translate"></div>
            }
            @if (modal.id === 'info' && !loading) {
              <app-indexing-form #indexingForm [groupId]="currentGroupId"
                [indexingFormId]="currentResourceInformations.modelId" [resId]="currentResourceInformations.resId"
                [mode]="'process'" [canEdit]="canEditData" [hideDiffusionList]="true" [canChangeModel]="canChangeModel"
                (loadingFormEndEvent)="triggerProcessAction()" (reloadBadge)="refreshBadge(1,'linkedResources')"
                (retrieveDocumentEvent)="appDocumentViewer.saveDocService()" (afterSaveEvent)="refreshData()">
              </app-indexing-form>
              } <!-- EDISSYUM - NCH01 Amélioration de l'écran de qualification pour récupérer les données par défaut | ajout canChangeModel -->
              <div style="position: sticky;bottom: 0px;text-align:right;padding:15px;">
                @if (indexingForm !== undefined && indexingForm.isResourceModified() && modal.id === 'info') {
                  <button mat-fab
                    (click)="confirmModification()" class="accent"
                    [title]="'lang.saveModifications' | translate">
                    <mat-icon style="height:auto;font-size:20px;" class="fas fa-check"></mat-icon>
                  </button>
                }
                @if (appDiffusionsList !== undefined && appDiffusionsList.isModified() && modal.id === 'diffusionList') {
                  <button mat-fab [title]="'lang.saveModifications' | translate"
                    (click)="saveListinstance()" class="accent">
                    <mat-icon style="height:auto;font-size:20px;" class="fas fa-check"></mat-icon>
                  </button>
                }
                @if (appVisaWorkflow !== undefined && !appVisaWorkflow.workflowParametersNotValid() && appVisaWorkflow.isModified() && modal.id === 'visaCircuit') {
                  <button mat-fab [title]="'lang.saveModifications' | translate"
                    (click)="saveVisaWorkflow()" class="accent">
                    <mat-icon style="height:auto;font-size:20px;" class="fas fa-check"></mat-icon>
                  </button>
                }
              </div>
            </div>
          </div>
        }
      </mat-sidenav-content>
      <mat-sidenav #snav2 [fixedInViewport]="appService.getViewMode()" position='end'
        [opened]="appService.getViewMode() ? false : false" [mode]="appService.getViewMode() ? 'over' : 'side'"
        class="panel-right" style="overflow-x:hidden;" [class.docView]="!filtersListService.filterMode"
        [ngStyle]="{'width': appService.getViewMode() ? '80%' : '30%'}" autoFocus="false">
      </mat-sidenav>
    </mat-sidenav-container>
