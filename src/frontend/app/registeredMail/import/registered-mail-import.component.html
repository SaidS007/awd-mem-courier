<div class="mat-dialog-content-container">
  <h1 mat-dialog-title>{{'lang.importRegisteredMails' | translate}}</h1>
  <div mat-dialog-content>
    @if (csvData.length > 0) {
      <div class="alert-message alert-message-info" [innerHTML]="'lang.infoImportregisteredMails' | translate" style="min-width: 100%">
      </div>
    }
    <mat-toolbar class="import-tool" [class.hide]="csvData.length === 0 || loading">
      <span style="flex:1;">
        <mat-slide-toggle class="primary" [checked]="hasHeader" (change)="toggleHeader()">
          {{'lang.csvHeader' | translate}}
        </mat-slide-toggle>
      </span>
      <span style="flex:1;text-align: right; color: #3A7C00"><i class="fas fa-dolly-flatbed"
      ></i>&nbsp;{{'lang.registeredMails' | translate}} : <b
    class="primary">{{countAll}}</b>
  </span>
  <span style="flex:1;text-align: right;">
    <mat-form-field appearance="outline" style="width:250px !important;height: 55px;">
      <mat-label>{{'lang.indexingModel' | translate}}</mat-label>
      <mat-select [(ngModel)]="currentIndexingModel" (click)="$event.stopPropagation()">
        @for (model of indexingModels; track model) {
          <mat-option [value]="model.id">
            {{model.label}}
          </mat-option>
        }
      </mat-select>
    </mat-form-field>
  </span>
</mat-toolbar>
@if (loading) {
  <div class="loader">
    <mat-spinner></mat-spinner>
  </div>
} @else {
  <input type="file" name="files[]" #uploadFile id="uploadFile" (change)="uploadCsv($event)" accept=".csv"
    style="display: none;">
  @if (csvData.length === 0) {
    <div appUploadFileDragDrop (click)="uploadFile.click()"
      (fileDropped)="dndUploadFile($event)" class="dndFile">
      <div>
        {{'lang.dndFileCsvDesc' | translate}}
        <!--<mat-form-field appearance="outline" style="font-size:14px;" (click)="$event.stopPropagation()">
        <mat-label>{{'lang.delimiter' | translate}}</mat-label>
        <mat-select [(ngModel)]="currentDelimiter" (click)="$event.stopPropagation()">
          <mat-option *ngFor="let delimiter of delimiters" [value]="delimiter">
            {{delimiter === '\t' ? 'TAB' : delimiter}}
          </mat-option>
        </mat-select>
      </mat-form-field>-->
    </div>
  </div>
}
@if (csvData.length > 0) {
  <div class="row" style="margin: 0px;">
    <div class="col-md-12">
      <mat-paginator #paginator [length]="100" [hidePageSize]="true" [pageSize]="10">
      </mat-paginator>
    </div>
  </div>
}
@if (csvData.length > 0) {
  <div class="tableContent">
    <div style="overflow: auto;">
      <mat-table #table [dataSource]="dataSource"
        [style.width.px]="contactColumns.length * 300">
        @for (column of contactColumns; track column; let i = $index) {
          <ng-container [matColumnDef]="column.id">
            <mat-header-cell *matHeaderCellDef style="padding-left: 5px;padding-right: 5px;">
              @if (!column.form) {
                <i class="fas fa-database"
                [title]="'lang.dbColumn' | translate" style="color: #3A7C00"></i>&nbsp;<b class="primary colLabel"
              [title]="'lang.dbColumn' | translate" >{{column.label}}</b>
              &nbsp;<i class="fas fa-arrows-alt-h"></i>&nbsp;
              <i class="fas fa-file-csv" [title]="'lang.csvColumn' | translate"></i>&nbsp;
              <mat-form-field [title]="'lang.csvColumn' | translate"
                (click)="$event.stopPropagation()" style="width: 80px !important;">
                <mat-select [(ngModel)]="associatedColumns[column.id]"
                  (selectionChange)="changeColumn(column, $event.value)">
                  <mat-option value=""></mat-option>
                  @for (col of csvColumns; track col) {
                    <mat-option [value]="col">
                      {{col}}
                    </mat-option>
                  }
                </mat-select>
              </mat-form-field>
            } @else {
              @if (column.id !== 'departureDate') {
                <button mat-button [matMenuTriggerFor]="menu" style="padding:0px;"><b class="colLabel primary"
                >{{column.label}}</b>
                <mat-icon matSuffix class="fa fa-caret-down"></mat-icon>
              </button>
              <mat-menu #menu="matMenu">
                @for (val of column.values; track val) {
                  <button mat-menu-item
                    (click)="changeColumn(column, val.id)">
                    <span>{{val.label}}</span>
                  </button>
                }
              </mat-menu>
            } @else {
              <mat-form-field style="display: none;">
                <input matInput [matDatepicker]="picker" (dateChange)="changeColumn(column, $event.value)">
                <mat-datepicker #picker></mat-datepicker>
              </mat-form-field>
              <button mat-button (click)="picker.open()" style="padding:0px;"><b
              class="primary">{{column.label}}</b>
              <mat-icon matSuffix class="fa fa-caret-down"></mat-icon>
            </button>
          }
        }
      </mat-header-cell>
      <mat-cell *matCellDef="let element" style="padding-left: 5px;padding-right: 5px;">
        {{getLabel(column.id,element[column.id])}}
      </mat-cell>
    </ng-container>
  }
  <mat-header-row *matHeaderRowDef="getcontactColumnsIds()"></mat-header-row>
  <mat-row *matRowDef="let row; columns: getcontactColumnsIds();"></mat-row>
</mat-table>
</div>
</div>
}
}
</div>
<span class="divider-modal"></span>
<div mat-dialog-actions class="actions">
  @if (csvData.length > 0) {
    <button mat-raised-button mat-button class="primary" [disabled]="loading"
    (click)="onSubmit()">{{'lang.validate' | translate}}</button>
  }
  <button mat-raised-button mat-button [disabled]="loading"
  [mat-dialog-close]="">{{'lang.cancel' | translate }}</button>
</div>
</div>