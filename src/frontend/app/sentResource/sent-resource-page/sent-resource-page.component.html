<div class="mat-dialog-content-container">
  <h1 mat-dialog-title>
    <span style="flex: 1;">
      {{data.title}}
    </span>
    <button [title]="'lang.saveAndClose' | translate" mat-icon-button (click)="closeModal()">
      <mat-icon class="fa fa-times"></mat-icon>
    </button></h1>
    <mat-dialog-content class="modal-container">
      @if (loading) {
        <div class="loading">
          <mat-spinner style="margin:auto;"></mat-spinner>
        </div>
      }
      @if (!loading) {
        <app-mail-editor #appMailEditor [resId]="data.resId" [emailId]="data.emailId" [emailType]="data.emailType" (afterLoadPaperAr)="paperArContent=$event"></app-mail-editor>
      }
      @if (paperArContent !== null) {
        <app-document-viewer #appDocumentViewer
          style="display:block;height:400px;width:100%;overflow: auto;" [editMode]="false"
          [base64]="paperArContent">
        </app-document-viewer>
      }
    </mat-dialog-content>
    <span class="divider-modal"></span>
    @if (!loading) {
      <div mat-dialog-actions class="actions">
        @if (!appMailEditor?.readonly && privilegeService.hasCurrentUserPrivilege('sendmail')) {
          <button mat-raised-button
            style="min-width: auto;width: 30px;padding: 0;background-color: white; color: grey;"
            [matMenuTriggerFor]="emailActionMenu">
            <mat-icon style="height:auto;" class="fas fa-ellipsis-v"></mat-icon>
          </button>
        }
        <mat-menu #emailActionMenu="matMenu" [class]="'attachListMenu'">
          @if (appMailEditor?.htmlMode) {
            <button mat-menu-item (click)="appMailEditor?.switchEditionMode()">
              {{'lang.switchInPlainText' | translate}}
            </button>
          }
          @if (!appMailEditor?.htmlMode) {
            <button mat-menu-item (click)="appMailEditor?.switchEditionMode()">
              {{'lang.switchInHtml' | translate}}
            </button>
          }
        </mat-menu>
        @if (!appMailEditor?.readonly && privilegeService.hasCurrentUserPrivilege('sendmail')) {
          <button mat-raised-button
            class="primary"
            (click)="onSubmit()"
            [disabled]="appMailEditor?.recipients.length === 0 || appMailEditor?.emailSubject.length > 256 || isDisabled"> <!-- EDISSYUM - ASY01 Implémentation envoie de Mail sécurisé via Pastell | Ajout de || isDisabled dans [disabled] -->
            {{'lang.send' | translate}}
          </button>
        }
        @if (data.emailId && data.emailType === 'email') {
          <button mat-raised-button class="warn" (click)="deleteEmail()"
          [disabled]="headerService.user.id !== appMailEditor?.emailCreatorId || appMailEditor?.emailStatus === 'SENT'">{{'lang.delete' | translate}}</button>
        }
      </div>
    }
  </div>
