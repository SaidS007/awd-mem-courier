<form>
  <input type="hidden" [formControl]="control">
  @if (!control.disabled) {
    <mat-form-field floatLabel="never" class="input-form">
      <button style="left: 20px;z-index: 1; color: #3A7C00" type="button" matPrefix mat-icon-button (click)="$event.stopPropagation();openThesaurus()">
        <mat-icon class="fas fa-external-link-alt" style="font-size: 15px;" [title]="'lang.openThesaurus' | translate"></mat-icon>
      </button>
      <input type="text" #autoCompleteInput [placeholder]="'lang.searchTag' | translate" matInput [formControl]="myControl"
        [matAutocomplete]="auto" (click)="$event.stopPropagation()" (focus)="resetAutocomplete()" maxlength="128">
      <button [disabled]="!canAdd || myControl.value === null || myControl.value.length === 0" type="button" matSuffix mat-icon-button (click)="addItem()">
        <mat-icon class="fa fa-plus" [title]="'lang.add' | translate" [style.visibility]="canAdd && myControl.value !== null && myControl.value.length > 0 ? 'visible' : 'hidden'"></mat-icon>
      </button>
      <mat-autocomplete #auto="matAutocomplete" (optionSelected)="selectOpt($event)">
        @if (options.length > 0 && !loading) {
          @for (option of filteredOptions | async | sortBy: key; track option) {
            <mat-option [value]="option" [title]="option[key]">
              <span class="primary">{{option[key]}}</span>
            </mat-option>
          }
        }
        @if (options.length === 0 && !loading) {
          <mat-option class="autoCompleteInfoResult smallInputInfo" disabled
            [innerHTML]="listInfo">
          </mat-option>
        }
        @if (loading) {
          <mat-option disabled>
            <mat-spinner diameter="20"></mat-spinner>
          </mat-option>
        }
      </mat-autocomplete>
    </mat-form-field>
  }
  <div class="itemList">
    @if (control.value.length > 0) {
      <mat-chip-list class="mat-chip-list-stacked itemChip" >
        @for (item of control.value; track item; let i = $index) {
          <mat-chip class="listAutocomplete"
            [removable]="!control.disabled" (removed)="removeItem(i)" (click)="openThesaurus(item)">
            <span style="display: flex;flex: 1;align-items: center;cursor: pointer;" [title]="getTagLabel(item)">
              <i class="fa fa-tag" style="padding-right:5px;"></i>&nbsp;{{getTagLabel(item)}}
            </span>
            @if (!control.disabled) {
              <mat-icon matChipRemove class="fa fa-times"></mat-icon>
            }
          </mat-chip>
        }
      </mat-chip-list>
    }
    @if (control.value.length === 0) {
      <div class="noResult">
        {{'lang.noSelectedTag' | translate}}
      </div>
    }
  </div>
</form>