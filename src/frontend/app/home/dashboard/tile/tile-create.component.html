<div class="mat-dialog-content-container">
  <h1 mat-dialog-title>{{'lang.addTile' | translate}}</h1>
  <div mat-dialog-content>
    @if (loading) {
      <div class="loading" style="display:flex;height:100%;">
        <mat-spinner style="margin:auto;"></mat-spinner>
      </div>
    }
    <mat-form-field class="select-tile-type" appearance="outline">
      <button mat-icon-button matSuffix [title]="'lang.tileColor' | translate" (click)="$event.stopPropagation()"
        [matMenuTriggerFor]="menuColor">
        <mat-icon class="fa fa-circle" [style.color]="selectedColor"></mat-icon>
      </button>
      <mat-menu #menuColor="matMenu">
        <color-github style="color:#ef9a9a" width="100%" [colors]="dashboardService.getColors()" [triangle]="'hide'"
        (onChangeComplete)="handleChange($event)"></color-github>
      </mat-menu>
      <mat-label>{{'lang.tileType' | translate}}</mat-label>
      <mat-select [(ngModel)]="selectedTileType" (selectionChange)="getViews()">
        @for (tileType of tileTypes | sortBy : 'label'; track tileType) {
          <mat-option
            [value]="tileType.id"
            [disabled]="!canDisplayType(tileType)"
            [title]="getTitle(tileType)">
          {{tileType.label}}
        </mat-option>
      }
    </mat-select>
  </mat-form-field>
  @if (selectedTileType === 'basket') {
    <mat-form-field appearance="outline">
      <mat-label>{{'lang.basket' | translate}}</mat-label>
      <mat-select [compareWith]="this.compareBaskets" (selectionChange)="setBasket($event.value)" [(ngModel)]="extraParams">
        @for (grpBasket of baskets; track grpBasket) {
          <mat-optgroup class="basket-group" [label]="grpBasket.groupDesc">
            @for (basket of grpBasket.baskets; track basket) {
              <mat-option
                [value]="{groupId:grpBasket.groupSerialId,groupName:grpBasket.groupDesc,basketId:basket.id,basketName:basket.basket_name}">
                {{basket.basket_name}}
              </mat-option>
            }
          </mat-optgroup>
        }
      </mat-select>
    </mat-form-field>
  }
  @if (selectedTileType === 'folder') {
    <mat-form-field appearance="outline">
      <mat-label>{{'lang.folderPinned' | translate}}</mat-label>
      <mat-select [compareWith]="this.compareFolders" [(ngModel)]="extraParams">
        @for (folder of folders | sortBy : 'label'; track folder) {
          <mat-option [value]="{folderId:folder.id}">
            {{folder.label}}
          </mat-option>
        }
      </mat-select>
    </mat-form-field>
  }
  @if (selectedTileType === 'shortcut') {
    <app-plugin-select-search [appearance]="'outline'" [showLabel]="true"
      [class]="''" [label]="'lang.navigation' | translate" [datas]="menus" [formControlSelect]="menusControl"  [returnValue]="'object'" [dataKey]="'id'"
      (afterSelected)="setMenu($event)">
    </app-plugin-select-search>
  }
  @if (extraParams.privilegeId === 'indexing') {
    <mat-form-field appearance="outline">
      <mat-label>{{'lang.group' | translate}}</mat-label>
      <mat-select [compareWith]="this.compareGroups" [(ngModel)]="extraParams.groupId" (selectionChange)="setIndexingGroup($event.value)">
        @for (group of menusControl.value.groups | sortBy : 'label'; track group) {
          <mat-option [value]="group">
            {{group.label}}
          </mat-option>
        }
      </mat-select>
    </mat-form-field>
  }
  @if (selectedTileType === 'searchTemplate') {
    <app-plugin-select-search [appearance]="'outline'" [showLabel]="true"
      [class]="''" [label]="'lang.model' | translate" [datas]="searchTemplates" [formControlSelect]="searchTemplatesControl"  [returnValue]="'object'" [dataKey]="'id'"
      (afterSelected)="setSearchTemplate($event)">
    </app-plugin-select-search>
  }
  <!-- Display of enabled signatory book
  <mat-form-field appearance="outline" *ngIf="views.length > 0 && selectedTileType === 'externalSignatoryBook'">
    <mat-label>{{ 'lang.enabledSignatoryBook' | translate }}</mat-label>
    <input matInput [(ngModel)]="enabledSignatoryBook" readonly
      [title]="'lang.' + authService.externalSignatoryBook.id | translate">
  </mat-form-field>
  -->
  @if (views.length > 0) {
    <mat-form-field appearance="outline">
      <mat-label>{{'lang.chartView' | translate}}</mat-label>
      <mat-select [(ngModel)]="selectedView" (selectionChange)="resetExtraParams()">
        @for (view of views | sortBy : 'label'; track view) {
          <mat-option [value]="view.id">
            {{view.label}}
          </mat-option>
        }
      </mat-select>
    </mat-form-field>
  }
  @if (selectedView === 'chart') {
    <mat-form-field appearance="outline">
      <mat-label>{{'lang.type' | translate}}</mat-label>
      <mat-select [(ngModel)]="extraParams.chartType" (selectionChange)="setChartModes()">
        @for (charType of chartTypes | sortBy: 'label'; track charType) {
          <mat-option [value]="charType.type">
            {{'lang.chart_' + charType.type | translate}}
          </mat-option>
        }
      </mat-select>
    </mat-form-field>
  }
  @if (!functionsService.empty(extraParams.chartType)) {
    <mat-form-field appearance="outline">
      <mat-label>{{'lang.displayMode' | translate}}</mat-label>
      <mat-select [(ngModel)]="extraParams.chartMode">
        @for (mode of chartModes | sortBy: 'label'; track mode) {
          <mat-option [value]="mode.id">
            {{mode.label}}
          </mat-option>
        }
      </mat-select>
    </mat-form-field>
  }
</div>
<span class="divider-modal"></span>
<div mat-dialog-actions class="actions">
  <button mat-raised-button mat-button class="primary" [disabled]="loading || !isValid()"
  (click)="onSubmit()">{{'lang.validate' | translate}}</button>
  <button mat-raised-button mat-button [disabled]="loading"
  [mat-dialog-close]="">{{'lang.cancel' | translate}}</button>
</div>
</div>